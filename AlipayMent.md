支付宝的系统采用的是一个典型的从渠道到产品到服务到支付渠道的应用架构，其中服务根据业务的发展，一方面考虑平衡业务的增长与创新，另一方面考虑系统的安全、稳定、可伸缩。所以系统架构设计上需要构建稳定的基础业务服务，通过服务重用实现业务敏捷，同时保障核心安全稳定。

对于各类的支付场景，其典型处理模式如上图所示，互联网商户访问渠道系统，通过API平台接入，经过产品层，封装订单处理，然后调用收银台或者直接调用交易，交易过程中附加计费、营销、风控，然后到支付处理，支付处理再到清算处理和账户会计处理，最后通过渠道通信前置调用银行渠道完成支付交易落地。

支付交易的处理在上述流程下就很好理解了，首先，业务系统通过收银台或者支付API将交易发到支付系统，支付系统通过账务交易记录账务并给到会计系统，然后通过清算模块与银行渠道完成支付落地，最后将清算模块与会计记录进行核算。

在支付清算中，支付宝分了支付系统和清算系统作为联机交易，其实这就是我们之前讲的支付系统设计中的支付产品和支付渠道，然后通过记账指定给到账务系统里再做记账，联机记录交易流水，异步做复式记账。这其实也是我们在设计支付清算系统的时候的一个原则：为提高交易性能，交易必须与账务分离，以提高交易处理性能和效率，从而有针对性的分块解决复杂业务逻辑。所以，我们在支付系统设计中一般是将记账为分2个步骤，支付成功后系统同步记录流水账，异步通知会计系统做复式记账。

支付系统中实现四种的支付方式，充值，提现，内转，充退等。而清算系统完成跟渠道之间的渠道管理、任务调度、实时处理以及文件处理、还有接收异步清算处理。

支付宝架构中的交易系统就是我们之前支付系统架构设计中支付产品所实现的功能，包括各种支付方式的实现（担保交易、即时到账交易、货到付款交易等）。另外，这里面还包括了：数据持久、流程引擎、规则引擎、超时处理、资金处理、产品账接入、收费接入、商户通知、统一事件等。